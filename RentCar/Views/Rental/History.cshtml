@model IEnumerable<RentCar.Models.TrRental>

@{
    ViewData["Title"] = "Riwayat Penyewaan";
}

<style>
    /* Table & Status */
    .history-container {
        margin-top: 30px;
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .page-title {
        font-size: 1.8rem;
        color: #333;
        margin-bottom: 20px;
        border-bottom: 2px solid #6a1b9a;
        padding-bottom: 10px;
        display: inline-block;
    }

    /* Table Styling */
    .custom-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

        .custom-table th, .custom-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .custom-table th {
            background-color: #f8f9fa;
            color: #555;
            font-weight: bold;
        }

        .custom-table tr:hover {
            background-color: #f1f1f1;
        }

    /* Status Badge */
    .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        text-transform: uppercase;
    }

    .badge-paid {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .badge-unpaid {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    /* Button Pay */
    .btn-pay {
        background-color: #6a1b9a;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-size: 0.9rem;
        transition: background 0.3s;
    }

        .btn-pay:hover {
            background-color: #4a148c;
        }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: #777;
    }
</style>

<div class="history-container">
    <h2 class="page-title">Riwayat Penyewaan Saya</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div style="background:#d4edda; color:#155724; padding:15px; margin-bottom:20px; border-radius:5px;">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Mobil</th>
                    <th>Tanggal Sewa</th>
                    <th>Tanggal Kembali</th>
                    <th>Total Harga</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <strong>@item.Car.Name</strong><br />
                            <small style="color:#777;">@item.Car.LicensePlate</small>
                        </td>
                        <td>@item.RentalDate.ToString("dd MMM yyyy")</td>
                        <td>@item.ReturnDate.ToString("dd MMM yyyy")</td>
                        <td style="font-weight:bold; color:#333;">
                            Rp. @item.TotalPrice.ToString("N0")
                        </td>
                        <td>
                            @if (item.PaymentStatus)
                            {
                                <span class="badge badge-paid">Lunas</span>
                            }
                            else
                            {
                                <span class="badge badge-unpaid">Belum Bayar</span>
                            }
                        </td>
                        <td>
                            @if (!item.PaymentStatus)
                            {
                                <form asp-controller="Rental" asp-action="Pay" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="rentalId" value="@item.RentalId" />
                                    <button type="submit" class="btn-pay" onclick="return confirm('Anda yakin ingin membayar tagihan ini?')">
                                        Bayar Sekarang
                                    </button>
                                </form> 
                            }
                            else
                            {
                                <span style="color:#28a745;">✔ Selesai</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="empty-state">
            <h3>Belum ada riwayat penyewaan.</h3>
            <p>Silakan sewa mobil impian anda di halaman utama.</p>
            <a asp-controller="Car" asp-action="Index" style="color:#6a1b9a; font-weight:bold;">Cari Mobil</a>
        </div>
    }
</div>

